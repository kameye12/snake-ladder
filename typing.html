<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Typing Defense (Easy Mode)</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&family=Kanit:wght@400;600;800&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        margin: 0;
        padding: 0;
        background-color: #0d0d0d;
        color: #00ff41;
        font-family: "Kanit", sans-serif; /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡∏´‡∏•‡∏±‡∏Å‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢ */
        overflow: hidden;
        user-select: none;
      }

      /* UI Layer */
      #ui-layer {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 10;
        padding: 20px;
        box-sizing: border-box;
        display: flex;
        justify-content: space-between;
      }

      .hud-box {
        background: rgba(0, 0, 0, 0.9); /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏ó‡∏∂‡∏ö‡∏Ç‡∏∂‡πâ‡∏ô */
        border: 2px solid #00ff41;
        padding: 15px;
        border-radius: 10px;
        box-shadow: 0 0 15px rgba(0, 255, 65, 0.3);
      }

      h1 {
        margin: 0;
        font-size: 28px;
        text-shadow: 0 0 5px #00ff41;
        font-weight: 800;
      }
      .stat {
        font-size: 20px;
        margin-top: 5px;
        font-weight: 600;
      }
      .danger {
        color: #ff3838;
        text-shadow: 0 0 5px red;
        letter-spacing: 5px;
      }

      /* ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏° */
      #game-area {
        position: relative;
        width: 100%;
        height: 100vh;
        /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡πÜ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏≠‡∏≠‡∏Å‡∏á‡πà‡∏≤‡∏¢ */
        background: #111;
      }

      /* ‡πÄ‡∏™‡πâ‡∏ô‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï‡∏ï‡∏≤‡∏¢ */
      #danger-line {
        position: absolute;
        bottom: 60px;
        width: 100%;
        height: 3px;
        background: #ff3838;
        box-shadow: 0 0 20px #ff3838;
        z-index: 5;
      }
      #danger-line::after {
        content: "DANGER ZONE";
        position: absolute;
        right: 20px;
        bottom: 10px;
        color: #ff3838;
        font-size: 12px;
        opacity: 0.7;
      }

      /* --- ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏ï‡∏±‡∏ß‡∏õ‡∏µ‡∏®‡∏≤‡∏à (‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢‡∏™‡∏∏‡∏î‡πÜ) --- */
      .monster {
        position: absolute;
        color: white;
        font-family: "Kanit", sans-serif; /* ‡πÉ‡∏ä‡πâ‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢ */
        font-weight: 800; /* ‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏≤ */
        font-size: 28px; /* ‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏ç‡πà‡∏™‡∏∞‡πÉ‡∏à (‡πÄ‡∏î‡∏¥‡∏° 20px) */

        background: #000; /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏î‡∏≥‡∏ó‡∏∂‡∏ö ‡πÑ‡∏°‡πà‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÅ‡∏™‡∏á */
        padding: 8px 16px;
        border: 2px solid #555; /* ‡∏Ç‡∏≠‡∏ö‡∏™‡∏µ‡πÄ‡∏ó‡∏≤ */
        border-radius: 8px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);

        transform: translateX(-50%);
        white-space: nowrap;
        z-index: 20;
      }

      /* ‡πÑ‡∏Æ‡πÑ‡∏•‡∏ó‡πå‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ñ‡∏π‡∏Å */
      .highlight {
        color: #00ff41;
        text-shadow: 0 0 10px #00ff41;
      }

      /* Input Box */
      #input-display {
        position: absolute;
        bottom: 10px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 30px; /* ‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô */
        font-weight: bold;
        color: #00ff41;
        border: 3px solid #00ff41;
        padding: 10px 30px;
        background: #000;
        min-width: 250px;
        text-align: center;
        border-radius: 10px;
        z-index: 30;
        box-shadow: 0 0 20px rgba(0, 255, 65, 0.2);
      }

      .home-btn {
        position: fixed;
        top: 10px;
        left: 10px;
        z-index: 100;
        background: #333;
        color: white;
        padding: 8px 15px;
        text-decoration: none;
        border-radius: 5px;
        font-family: "Kanit";
        border: 1px solid #555;
      }

      #game-over-screen {
        display: none;
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.95);
        z-index: 50;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: white;
      }
      #restart-btn {
        padding: 15px 40px;
        font-size: 24px;
        cursor: pointer;
        background: #00ff41;
        border: none;
        font-weight: bold;
        border-radius: 50px;
        margin-top: 20px;
        box-shadow: 0 0 20px #00ff41;
        color: black;
        font-family: "Kanit";
      }

      </script>
    <style>
        /* Animation ‡∏ï‡∏≠‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ñ‡∏π‡∏Å */
        @keyframes pop {
        0% {
          transform: translateX(-50%) scale(1);
        }
        50% {
          transform: translateX(-50%) scale(1.1);
        }
        100% {
          transform: translateX(-50%) scale(1);
        }
      }
      .pop-anim {
        animation: pop 0.1s ease-in-out;
      }
    </style>
  </head>
  <body>
    <a href="/" class="home-btn">üè† Home</a>

    <div id="ui-layer">
      <div class="hud-box">
        <h1>TYPE DEFENSE</h1>
        <div class="stat">Score: <span id="score">0</span></div>
        <div class="stat">HP: <span id="hp" class="danger">‚ù§‚ù§‚ù§</span></div>
      </div>

      <div class="hud-box">
        <div style="font-weight: bold; margin-bottom: 5px; font-size: 18px">
          üèÜ Top Scores
        </div>
        <div id="leaderboard" style="font-size: 16px; line-height: 1.6">
          Waiting...
        </div>
      </div>
    </div>

    <div id="game-area">
      <div id="danger-line"></div>
    </div>

    <div id="input-display">‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡∏¢!</div>

    <div id="game-over-screen">
      <h1 style="font-size: 60px; color: #ff3838; margin-bottom: 0">
        GAME OVER
      </h1>
      <p style="font-size: 24px; color: #aaa">‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß</p>
      <p style="font-size: 30px">
        ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°:
        <span id="final-score" style="color: #00ff41; font-weight: bold"
          >0</span
        >
      </p>
      <button id="restart-btn" onclick="location.reload()">
        ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
      </button>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      const socket = io("/typing", { transports: ["websocket"] });

      // ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå (‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏ç‡πà‡∏´‡∏°‡∏î ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢)
      const wordsList = [
        "API",
        "APP",
        "BOT",
        "CSS",
        "DEV",
        "GIT",
        "IOS",
        "KEY",
        "LOG",
        "MAC",
        "NET",
        "PHP",
        "RAM",
        "SQL",
        "TAG",
        "URL",
        "USB",
        "VUE",
        "WEB",
        "XML",
        "CODE",
        "DATA",
        "DISK",
        "FILE",
        "GAME",
        "HOST",
        "ICON",
        "JAVA",
        "LINK",
        "MAIN",
        "NODE",
        "OPEN",
        "PATH",
        "ROOT",
        "RUBY",
        "SAVE",
        "TASK",
        "UNIT",
        "VOID",
        "WIFI",
        "ZOOM",
        "CLOUD",
        "DEBUG",
        "EMAIL",
        "FLASH",
        "GROUP",
        "HTML5",
        "INPUT",
        "LOGIN",
        "MOUSE",
        "PIXEL",
        "QUERY",
        "RESET",
        "SETUP",
      ];

      const gameArea = document.getElementById("game-area");
      const inputDisplay = document.getElementById("input-display");
      const scoreEl = document.getElementById("score");
      const hpEl = document.getElementById("hp");
      const gameOverScreen = document.getElementById("game-over-screen");

      let score = 0;
      let hp = 3;
      let currentInput = "";
      let activeMonsters = [];
      let gameRunning = true;

      // --- ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ---
      let spawnRate = 2500; // ‡∏≠‡∏≠‡∏Å‡∏ó‡∏∏‡∏Å 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ (‡πÄ‡∏î‡∏¥‡∏° 2‡∏ß‡∏¥)
      let fallSpeed = 1; // ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏ï‡∏Å (‡πÄ‡∏î‡∏¥‡∏° 1.5) -> ‡∏ä‡πâ‡∏≤‡∏•‡∏á‡πÄ‡∏Å‡∏∑‡∏≠‡∏ö 3 ‡πÄ‡∏ó‡πà‡∏≤
      // -----------------------

      function spawnMonster() {
        if (!gameRunning) return;

        const word = wordsList[Math.floor(Math.random() * wordsList.length)];

        const el = document.createElement("div");
        el.className = "monster";
        el.innerText = word;

        // ‡∏™‡∏∏‡πà‡∏°‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á X (‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ï‡∏Å‡∏Ç‡∏≠‡∏ö)
        const xPos = Math.random() * (window.innerWidth - 200) + 100;
        el.style.left = `${xPos}px`;
        el.style.top = `-60px`;

        gameArea.appendChild(el);

        activeMonsters.push({
          element: el,
          word: word,
          top: -60,
        });

        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å‡∏ó‡∏µ‡∏•‡∏∞‡∏ô‡∏¥‡∏î (‡∏ä‡πâ‡∏≤‡πÜ)
        if (score > 0 && score % 50 === 0) {
          fallSpeed += 0.1; // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏ó‡∏µ‡∏•‡∏∞‡∏ô‡∏¥‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
          spawnRate = Math.max(1000, spawnRate - 100);
        }

        setTimeout(spawnMonster, spawnRate);
      }

      function gameLoop() {
        if (!gameRunning) return;

        const dangerLineY = window.innerHeight - 60; // ‡πÄ‡∏™‡πâ‡∏ô‡∏ï‡∏≤‡∏¢

        activeMonsters.forEach((monster, index) => {
          monster.top += fallSpeed;
          monster.element.style.top = `${monster.top}px`;

          if (monster.top > dangerLineY) {
            takeDamage(index);
          }
        });

        requestAnimationFrame(gameLoop);
      }

      window.addEventListener("keydown", (e) => {
        if (!gameRunning) return;

        // ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£
        if (e.key.length === 1 && e.key.match(/[a-z0-9]/i)) {
          currentInput += e.key.toUpperCase();
        } else if (e.key === "Backspace") {
          currentInput = currentInput.slice(0, -1);
        }

        updateInputDisplay();
        checkMatch();
      });

      function updateInputDisplay() {
        inputDisplay.innerText = currentInput || "_";

        activeMonsters.forEach((m) => {
          if (m.word.startsWith(currentInput)) {
            // ‡πÑ‡∏Æ‡πÑ‡∏•‡∏ó‡πå‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß
            const matchPart = `<span class="highlight">${m.word.substr(
              0,
              currentInput.length
            )}</span>`;
            const restPart = m.word.substr(currentInput.length);
            m.element.innerHTML = matchPart + restPart;
            m.element.style.borderColor = "#00ff41";
            m.element.style.transform = "translateX(-50%) scale(1.1)"; // ‡∏Ç‡∏¢‡∏≤‡∏¢‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏ô‡∏¥‡∏î‡∏ô‡∏∂‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ñ‡∏π‡∏Å
          } else {
            m.element.innerText = m.word;
            m.element.style.borderColor = "#555";
            m.element.style.transform = "translateX(-50%) scale(1)";
          }
        });
      }

      function checkMatch() {
        const matchIndex = activeMonsters.findIndex(
          (m) => m.word === currentInput
        );

        if (matchIndex !== -1) {
          const monster = activeMonsters[matchIndex];

          // ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡∏ó‡∏≥‡∏•‡∏≤‡∏¢
          monster.element.style.background = "#00ff41";
          monster.element.style.color = "black";
          monster.element.innerText = "DESTROYED!";
          setTimeout(() => monster.element.remove(), 100);

          activeMonsters.splice(matchIndex, 1);

          score += 10;
          scoreEl.innerText = score;
          currentInput = "";

          // ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡∏ä‡πà‡∏≠‡∏á Input
          inputDisplay.classList.add("pop-anim");
          setTimeout(() => inputDisplay.classList.remove("pop-anim"), 100);

          updateInputDisplay();
          socket.emit("updateScore", score);
        }
      }

      function takeDamage(index) {
        const m = activeMonsters[index];
        m.element.style.background = "red"; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡πÅ‡∏î‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏≤‡∏¢
        setTimeout(() => m.element.remove(), 200);

        activeMonsters.splice(index, 1);

        hp--;
        hpEl.innerText = "‚ù§".repeat(hp);

        document.body.style.boxShadow = "inset 0 0 100px red";
        setTimeout(() => (document.body.style.boxShadow = "none"), 200);

        if (hp <= 0) {
          gameOver();
        }
      }

      function gameOver() {
        gameRunning = false;
        document.getElementById("final-score").innerText = score;
        gameOverScreen.style.display = "flex";
      }

      socket.on("updateLeaderboard", (data) => {
        const lbDiv = document.getElementById("leaderboard");
        lbDiv.innerHTML = Object.keys(data)
          .sort((a, b) => data[b] - data[a])
          .slice(0, 5)
          .map((id, i) => {
            let name = id === socket.id ? "YOU" : `Hacker ${id.substr(0, 3)}`;
            return `<div style="display:flex; justify-content:space-between; border-bottom:1px solid #333; padding:5px;">
                                <span>#${i + 1} ${name}</span>
                                <span style="color:#00ff41">${data[id]}</span>
                            </div>`;
          })
          .join("");
      });

      // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°
      setTimeout(spawnMonster, 1000);
      requestAnimationFrame(gameLoop);
    </script>
  </body>
</html>
